<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agriculture Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body
  class="bg-gray-100"
  style="background-image: url('images/back-home.jpg'); background-attachment: fixed;"
>
  <!-- Navbar -->
  <nav class="fixed top-0 left-0 w-full z-50 bg-green-700 text-white px-6 py-4 flex items-center justify-between">
    <!-- Logo -->
    <span class="font-bold text-xl">ğŸŒ± Agriculture Store</span>

    <!-- Search bar -->
    <div class="flex-grow mx-6">
      <input
        type="text"
        id="searchInput"
        placeholder="Search products..."
        class="w-full max-w-lg px-4 py-2 rounded-lg text-black focus:outline-none"
      />
    </div>

    <!-- Right side -->
    <div class="flex items-center space-x-4">
      <!-- Sell button -->
      <button
        onclick="location.href='sell.html'"
        class="bg-white text-green-700 px-4 py-2 rounded-lg font-semibold hover:bg-green-100"
      >
        Sell
      </button>

      <!-- Cart Icon -->
      <a href="cart.html" class="relative">
        <img src="images/cart.png" class="w-8 h-8" alt="Cart" />
        <span
          id="cartCount"
          class="absolute -top-2 -right-2 bg-red-500 text-xs text-white px-1 rounded-full"
        >0</span>
      </a>

      <!-- Profile Dropdown -->
      <div class="relative z-50">
        <button id="profileBtn">
          <div
  id="profileCircle"
  class="w-10 h-10 flex items-center justify-center rounded-full bg-white text-green-700 font-bold"
>
  <!-- Initial will go here -->
</div>
        </button>
        <div
          id="profileDropdown"
          class="hidden absolute right-0 mt-2 w-40 bg-white text-black rounded-lg shadow-lg p-3 z-50"
        >
          <p id="profileName" class="font-semibold">Guest</p>
          <button
            id="logoutBtn"
            class="mt-2 w-full bg-red-500 text-white py-1 rounded hover:bg-red-600"
          >
            Logout
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Filters & Categories -->
  <div class="fixed top-[64px] left-0 w-full bg-white shadow-md py-4 px-6 z-40">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <!-- Categories -->
      <div class="flex flex-wrap gap-3">
        <button class="categoryBtn bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" data-category="all">All</button>
        <button class="categoryBtn bg-gray-200 px-4 py-2 rounded-lg hover:bg-green-100" data-category="vegetables">Vegetables</button>
        <button class="categoryBtn bg-gray-200 px-4 py-2 rounded-lg hover:bg-green-100" data-category="fruits">Fruits</button>
        <button class="categoryBtn bg-gray-200 px-4 py-2 rounded-lg hover:bg-green-100" data-category="plants">Plants</button>
        <button class="categoryBtn bg-gray-200 px-4 py-2 rounded-lg hover:bg-green-100" data-category="seeds">Seeds</button>
        <button class="categoryBtn bg-gray-200 px-4 py-2 rounded-lg hover:bg-green-100" data-category="pesticides">Pesticides</button>
      </div>

      <!-- Price Filter -->
      <div class="flex items-center gap-3">
        <label class="font-medium">Price:</label>
        <input type="number" id="minPrice" placeholder="Min" class="w-20 px-2 py-1 border rounded"/>
        <span>-</span>
        <input type="number" id="maxPrice" placeholder="Max" class="w-20 px-2 py-1 border rounded"/>
        <button id="applyPriceFilter" class="bg-green-600 text-white px-3 py-1 rounded-lg hover:bg-green-700">Apply</button>
      </div>
    </div>
  </div>

  <!-- Slideshow -->
  <div class="relative w-full max-w-5xl mx-auto mt-44">
    <div class="overflow-hidden rounded-lg shadow-lg">
      <div id="slider" class="flex transition-transform duration-700">
        <div class="flex-shrink-0 w-full">
          <img src="images/offer.jpg" class="w-full h-64 object-cover" alt="Offer 1"/>
        </div>
        <div class="flex-shrink-0 w-full">
          <img src="images/offer1.jpg" class="w-full h-64 object-cover" alt="Offer 2"/>
        </div>
        <div class="flex-shrink-0 w-full">
          <img src="images/offer2.jpg" class="w-full h-64 object-cover" alt="Offer 3"/>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Section -->
  <div class="max-w-6xl mx-auto px-4 py-8">
    <h2 class="text-2xl font-bold text-green-700 mb-6 text-center">ğŸ¥¦ Vegetables</h2>
    <div id="vegetables" class="productGrid grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>

    <h2 class="text-2xl font-bold text-green-700 mb-6 mt-10 text-center">ğŸ Fruits</h2>
    <div id="fruits" class="productGrid grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>

    <h2 class="text-2xl font-bold text-green-700 mb-6 mt-10 text-center">ğŸŒ¿ Plants</h2>
    <div id="plants" class="productGrid grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>

    <h2 class="text-2xl font-bold text-green-700 mb-6 mt-10 text-center">ğŸŒ± Seeds</h2>
    <div id="seeds" class="productGrid grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>

    <h2 class="text-2xl font-bold text-green-700 mb-6 mt-10 text-center">ğŸ§´ Pesticides</h2>
    <div id="pesticides" class="productGrid grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
  </div>

  <!-- About Section -->
  <section class="bg-gray-900 text-white py-12 mt-10">
    <div class="max-w-5xl mx-auto px-6 text-center">
      <h2 class="text-3xl font-bold text-green-400 mb-6"><a href="about.html">About Us</a></h2>
      <p class="text-lg leading-relaxed mb-6">
        Welcome to <span class="font-semibold">ğŸŒ± Agriculture Store</span>, your trusted marketplace for fresh produce, seeds, plants, and farming essentials. We connect farmers directly with consumers, ensuring fresh, organic, and affordable products for everyone.
      </p>
      <p class="text-lg leading-relaxed">
        Our mission is to empower farmers, promote sustainable agriculture, and deliver quality goods at fair prices. Together, letâ€™s build a healthier and greener future! ğŸŒ¿
      </p>
    </div>
  </section>

  <script>
    const API_URL = "http://localhost:5000/api/products";

    // Profile toggle
    document.getElementById("profileBtn").addEventListener("click", () => {
      document.getElementById("profileDropdown").classList.toggle("hidden");
    });

    // Load username and profile image
   // Load username
const username = localStorage.getItem("username") || "Guest";
document.getElementById("profileName").textContent = username;

// Profile circle (first letter)
const profileCircle = document.getElementById("profileCircle");
profileCircle.textContent = username.charAt(0).toUpperCase();


    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("username");
      localStorage.removeItem("profilePic");
      localStorage.removeItem("token");
      alert("Logged Out successfully!");
      window.location.href = "login.html";
    });

    // Cart
    function readCart() { return JSON.parse(localStorage.getItem("cart")) || []; }
    function saveCart(cart) { localStorage.setItem("cart", JSON.stringify(cart)); updateCartCount(); }
    function updateCartCount() {
      const cart = readCart();
      document.getElementById("cartCount").innerText = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
    }
    function addToCart(product, price, image) {
      const cart = readCart();
      const index = cart.findIndex(item => item.product === product && item.price === price);
      if(index !== -1) cart[index].qty += 1;
      else cart.push({ product, price, qty: 1, image });
      saveCart(cart);
      alert(`${product} added to cart!`);
    }
    updateCartCount();

    // Render Products
    async function loadProducts() {
      try {
        const res = await fetch(API_URL);
        const products = await res.json();
        const categories = ["vegetables","fruits","plants","seeds","pesticides"];
        categories.forEach(cat => document.getElementById(cat).innerHTML = "");
        products.forEach(prod => {
          const container = document.getElementById(prod.category.toLowerCase());
          if(!container) return;
          container.innerHTML += `
            <div class="product bg-white shadow-lg rounded-lg p-4 text-center hover:shadow-xl transition">
              <img src="${prod.image}" class="w-32 h-32 mx-auto rounded-lg object-cover" alt="${prod.name}" />
              <h3 class="mt-3 font-semibold">${prod.name}</h3>
              <p class="text-gray-600">â‚¹${prod.price}</p>
              <button class="mt-3 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700"
                onclick="addToCart('${prod.name}', ${prod.price}, '${prod.image}')">
                Add to Cart
              </button>
            </div>
          `;
        });
      } catch (err) { console.error("Error loading products:", err); }
    }
    loadProducts();

    // Slideshow
    let currentIndex = 0;
    const slides = document.querySelectorAll("#slider > div");
    setInterval(() => {
      currentIndex = (currentIndex + 1) % slides.length;
      document.getElementById("slider").style.transform = `translateX(-${currentIndex * 100}%)`;
    }, 3000);

    // Search
    document.getElementById("searchInput").addEventListener("keyup", function() {
      const input = this.value.toLowerCase();
      document.querySelectorAll(".product").forEach(el => {
        el.style.display = el.textContent.toLowerCase().includes(input) ? "" : "none";
      });
    });

    // Category filter
    document.querySelectorAll(".categoryBtn").forEach(btn => {
      btn.addEventListener("click", function() {
        const category = this.dataset.category;
        document.querySelectorAll(".categoryBtn").forEach(b => {
          b.classList.remove("bg-green-600","text-white");
          b.classList.add("bg-gray-200");
        });
        this.classList.remove("bg-gray-200");
        this.classList.add("bg-green-600","text-white");
        if(category === "all") {
          document.querySelectorAll(".product").forEach(p => p.style.display = "");
        } else {
          document.querySelectorAll(".product").forEach(p => {
            p.style.display = p.closest(`#${category}`) ? "" : "none";
          });
        }
      });
    });

    // Price Filter
    document.getElementById("applyPriceFilter").addEventListener("click", () => {
      const min = parseFloat(document.getElementById("minPrice").value) || 0;
      const max = parseFloat(document.getElementById("maxPrice").value) || Infinity;
      document.querySelectorAll(".product").forEach(p => {
        const priceText = p.querySelector("p").innerText.replace(/[^0-9]/g,"");
        const price = parseFloat(priceText) || 0;
        p.style.display = price >= min && price <= max ? "" : "none";
      });
    });
  </script>
</body>
</html>
